{% extends "Business_User/business_base.html" %}

{% block title %}Register - MissCall App{% endblock %}

{% block auth_content %}
<div class="auth-container animate-fade-in">
    <div class="user-type-toggle">
        <button class="toggle-btn active" onclick="toggleUserType('business')">Business Register</button>
        <button class="toggle-btn" onclick="toggleUserType('customer')">Customer Register</button>
    </div>

    <!-- Business Registration Form -->
    <div id="business-register" class="auth-form-container">
        <div class="auth-logo">
            <i class="fas fa-user-plus"></i>
        </div>
        <h1 class="auth-title">Create Business Account</h1>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="flash-message error animate-shake">
                        <i class="fas fa-exclamation-circle"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form method="POST" action="{{ url_for('register') }}" class="auth-form">
            <input type="hidden" name="user_type" value="business">
            <div class="form-group">
                <label for="username">
                    <i class="fas fa-user"></i>
                    Username
                </label>
                <input type="text" id="username" name="username" required placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label for="password">
                    <i class="fas fa-lock"></i>
                    Password
                </label>
                <div class="password-input-container">
                    <input type="password" id="password" name="password" required placeholder="Choose a strong password">
                    <button type="button" class="toggle-password" onclick="togglePassword('password')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="password-requirements">
                    <p>Password must contain:</p>
                    <ul id="password-checks">
                        <li data-requirement="length"><i class="fas fa-circle"></i> At least 8 characters</li>
                        <li data-requirement="uppercase"><i class="fas fa-circle"></i> One uppercase letter</li>
                        <li data-requirement="lowercase"><i class="fas fa-circle"></i> One lowercase letter</li>
                        <li data-requirement="number"><i class="fas fa-circle"></i> One number</li>
                        <li data-requirement="special"><i class="fas fa-circle"></i> One special character</li>
                    </ul>
                </div>
            </div>
            <div class="form-group">
                <label for="phone_number">
                    <i class="fas fa-phone"></i>
                    Phone Number
                </label>
                <input type="tel" id="phone_number" name="phone_number" required placeholder="Enter your phone number">
            </div>

            <!-- Basic Tier Information -->
            <div class="tier-info">
                <h3>Basic Tier Subscription</h3>
                <div class="tier-details">
                    <p><i class="fas fa-coins"></i> Price: 150 BGN</p>
                    <p><i class="fas fa-star"></i> Initial Points: 200</p>
                    <p><i class="fas fa-list"></i> Select One Category</p>
                    <p><i class="fas fa-images"></i> Up to 5 Portfolio Images</p>
                    <p><i class="fas fa-money-bill-wave"></i> Cases up to 700 BGN</p>
                </div>
                <div class="form-group">
                    <label for="category">
                        <i class="fas fa-tag"></i>
                        Select Your Category
                    </label>
                    <select id="category" name="category" required>
                        <option value="">Choose a category</option>
                        <option value="Electrician">Electrician</option>
                        <option value="Plumber">Plumber</option>
                        <option value="Carpenter">Carpenter</option>
                        <option value="Painter">Painter</option>
                        <option value="HVAC">HVAC</option>
                    </select>
                </div>
            </div>

            <button type="submit" id="register-btn" class="auth-button">
                <i class="fas fa-user-plus"></i>
                Register
            </button>
        </form>
    </div>

    <!-- Customer Registration Form -->
    <div id="customer-register" class="auth-form-container" style="display: none;">
        <div class="auth-logo">
            <i class="fas fa-user-plus"></i>
        </div>
        <h1 class="auth-title">Create Customer Account</h1>
        <form method="POST" action="{{ url_for('register') }}" class="auth-form">
            <input type="hidden" name="user_type" value="customer">
            <div class="form-group">
                <label for="customer_username">
                    <i class="fas fa-user"></i>
                    Username
                </label>
                <input type="text" id="customer_username" name="username" required placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label for="customer_password">
                    <i class="fas fa-lock"></i>
                    Password
                </label>
                <div class="password-input-container">
                    <input type="password" id="customer_password" name="password" required placeholder="Choose a strong password">
                    <button type="button" class="toggle-password" onclick="togglePassword('customer_password')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <div class="password-requirements">
                    <p>Password must contain:</p>
                    <ul id="customer-password-checks">
                        <li data-requirement="length"><i class="fas fa-circle"></i> At least 8 characters</li>
                        <li data-requirement="uppercase"><i class="fas fa-circle"></i> One uppercase letter</li>
                        <li data-requirement="lowercase"><i class="fas fa-circle"></i> One lowercase letter</li>
                        <li data-requirement="number"><i class="fas fa-circle"></i> One number</li>
                        <li data-requirement="special"><i class="fas fa-circle"></i> One special character</li>
                    </ul>
                </div>
            </div>
            <div class="form-group">
                <label for="customer_phone">
                    <i class="fas fa-phone"></i>
                    Phone Number
                </label>
                <input type="tel" id="customer_phone" name="phone_number" pattern="\+359[0-9]{9}" placeholder="+359xxxxxxxxx" title="Please enter a valid Bulgarian phone number starting with +359" required>
            </div>
            <button type="submit" class="auth-btn" id="customer-register-btn" disabled>
                <i class="fas fa-user-plus"></i>
                Register
            </button>
        </form>
    </div>

    <div class="auth-links">
        <p>Already have an account? <a href="{{ url_for('login') }}">Login here</a></p>
    </div>
</div>

{% block scripts %}
<script>
function toggleUserType(userType) {
    const businessForm = document.getElementById('business-register');
    const customerForm = document.getElementById('customer-register');
    const buttons = document.querySelectorAll('.toggle-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    
    if (userType === 'business') {
        businessForm.style.display = 'block';
        customerForm.style.display = 'none';
        buttons[0].classList.add('active');
    } else {
        businessForm.style.display = 'none';
        customerForm.style.display = 'block';
        buttons[1].classList.add('active');
    }
}

const checks = {
    length: str => str.length >= 8,
    uppercase: str => /[A-Z]/.test(str),
    lowercase: str => /[a-z]/.test(str),
    number: str => /[0-9]/.test(str),
    special: str => /[!@#$%^&*(),.?":{}|<>]/.test(str)
};

function setupPasswordValidation(passwordId, btnId, checksListId) {
    const passwordInput = document.getElementById(passwordId);
    const registerBtn = document.getElementById(btnId);
    
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        let allValid = true;
        
        Object.entries(checks).forEach(([key, check]) => {
            const li = document.querySelector(`#${checksListId} [data-requirement="${key}"]`);
            const isValid = check(password);
            li.classList.toggle('valid', isValid);
            li.querySelector('i').className = isValid ? 'fas fa-check-circle' : 'fas fa-circle';
            allValid = allValid && isValid;
        });
        
        registerBtn.disabled = !allValid;
    });
}

function togglePassword(inputId) {
    const passwordInput = document.getElementById(inputId);
    const toggleBtn = passwordInput.parentElement.querySelector('.toggle-password i');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleBtn.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleBtn.classList.replace('fa-eye-slash', 'fa-eye');
    }
}

// Setup validation for both forms
setupPasswordValidation('password', 'register-btn', 'password-checks');
setupPasswordValidation('customer_password', 'customer-register-btn', 'customer-password-checks');
</script>
{% endblock %}
{% endblock %}